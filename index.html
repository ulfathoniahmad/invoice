<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Invoice Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

  <h2>Tambah Data Invoice</h2>
  <form id="invoiceForm" class="mb-4">
    <input class="form-control mb-2" name="namaProduk" placeholder="Nama Produk" required>
    <input class="form-control mb-2" name="jumlah" type="number" placeholder="Jumlah" required>
    <input class="form-control mb-2" name="harga" type="number" placeholder="Harga" required>
    <input class="form-control mb-2" name="tanggalOrder" type="date" required>
    <input class="form-control mb-2" name="pembeli" placeholder="Nama Pembeli" required>
    <button class="btn btn-primary" type="submit">Simpan</button>
  </form>

  <h2>Data Invoice</h2>
  <table class="table table-bordered" id="invoiceTable">
    <thead>
      <tr>
        <th>Produk</th><th>Jumlah</th><th>Harga</th><th>Total</th><th>Tanggal</th><th>Pembeli</th><th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfxxxxxxxxxxxx/exec"; // ganti dengan URL Apps Script

    document.getElementById("invoiceForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const formData = new FormData(this);

      const data = {
        namaProduk: formData.get("namaProduk"),
        jumlah: formData.get("jumlah"),
        harga: formData.get("harga"),
        total: formData.get("jumlah") * formData.get("harga"),
        tanggalOrder: formData.get("tanggalOrder"),
        pembeli: formData.get("pembeli"),
      };

      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(data)
      });

      this.reset();
      loadData();
    });

    async function loadData() {
      const res = await fetch(API_URL);
      const data = await res.json();

      const tbody = document.querySelector("#invoiceTable tbody");
      tbody.innerHTML = "";

      data.forEach((row, i) => {
        tbody.innerHTML += `
          <tr>
            <td>${row.namaProduk}</td>
            <td>${row.jumlah}</td>
            <td>${row.harga}</td>
            <td>${row.total}</td>
            <td>${row.tanggalOrder}</td>
            <td>${row.pembeli}</td>
            <td><button onclick="printInvoice(${i})" class="btn btn-sm btn-success">Cetak</button></td>
          </tr>
        `;
      });
    }

    function printInvoice(i) {
      const row = document.querySelectorAll("#invoiceTable tbody tr")[i].children;
      const win = window.open("", "Cetak Invoice", "width=600,height=400");
      win.document.write(`
        <h2>Invoice</h2>
        <p>Produk: ${row[0].innerText}</p>
        <p>Jumlah: ${row[1].innerText}</p>
        <p>Harga: Rp${row[2].innerText}</p>
        <p>Total: Rp${row[3].innerText}</p>
        <p>Tanggal: ${row[4].innerText}</p>
        <p>Pembeli: ${row[5].innerText}</p>
        <hr>
        <p><i>Terima kasih sudah berbelanja.</i></p>
      `);
      win.print();
    }

    loadData();
  </script>
</body>
</html>
